<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <title></title>
    <link href="css/mui.min.css" rel="stylesheet"/>
    <link rel="stylesheet" type="text/css" href="css/com.css"/>
	<link rel="stylesheet" type="text/css" href="css/bill.css"/>
</head>
<body>
	<header class="mui-bar mui-bar-nav">
	    <span class="mui-icon mui-pull-left" id="edit">编辑</span>
	    <h1 class="mui-title">清单</h1>
	</header>
	<footer>	
		<nav class="mui-bar mui-bar-tab">
	    <a class="mui-tab-item" href="index.html">
	        <span class="mui-icon indiana"></span>
	        <span class="mui-tab-label">夺宝</span>
	    </a>
	    <a class="mui-tab-item" href="announced.html">
	        <span class="mui-icon announced"></span>
	        <span class="mui-tab-label">揭晓</span>
	    </a>
	     <a class="mui-tab-item active" href="bill.html" id="bill" off='1'>
	        <span class="mui-icon bill">
	        	<!--<img src="image/icon_home_page3.png"/>-->
	        </span>
	        <span class="mui-tab-label">清单</span>
	    </a>
	    <a class="mui-tab-item" href="myset.html" id="myset" off='1'>
	        <span class="mui-icon my">
	        	<!--<img src="image/icon_home_page4.png"/>-->
	        </span>
	        <span class="mui-tab-label">我的</span>
	    </a>
		</nav>		
	</footer>

	
</body>
<script type="text/javascript">
	var h5pullDown = true;
</script>
<script src="js/mui.js" type="text/javascript" charset="utf-8"></script>
<script src="js/ajax.js" type="text/javascript" charset="utf-8"></script>
<script src="js/footer.js" type="text/javascript" charset="utf-8"></script>
<script type="text/javascript">
	


mui.init({
  subpages:[
	{
	    url:'view/bill-empty.html',//下拉刷新内容页面地址
	    id:'billEmpty',
	    styles:{
	    	top:'45px',
	    	bottom:'50px'
	    }
	},
	{
	  url:'view/bill-edit.html',//下拉刷新内容页面地址
      id:'billEdit',
      styles:{
      	top:'45px',
      	bottom:'50px'
      }
	},
	{
      url:'view/bill-list.html',//下拉刷新内容页面地址
      id:'billList',
      styles:{
      	top:'45px',
      	bottom:'50px'
      }
	}	
  ]
});

if(localStorage.user){
//先确保又userId既用户可以进来
	//再判断晒出 是 哪个子页面 既 空  商品 编辑
	var User = JSON.parse(localStorage.user);
	var UserInfo = User.userInfo;
	getBillList({
		userId:UserInfo.userId,
		token:UserInfo.caibaoToken,
		callback:function(res){
			console.log(res)
			var Obj = JSON.parse(res);
			if(Obj.code == 0){
				var ListArr = Obj.goodsSales;		
				if(!ListArr.length){
					//数组没数据					
					mui.openWindow({
						url:'view/bill-empty.html',
						id:'billEmpty',
						createNew:false
					})
					
				}else{
					//数组又长度 既有商品
					mui.openWindow({
						url:'view/bill-list.html',
						id:'billList',
						createNew:false
					})	
					var edit = document.querySelector('#edit');					
					var Drag = 1;
					edit.addEventListener('tap',function(){					
						if(Drag){
							//console.log('edit')
							this.innerHTML = '完成'
							mui.openWindow({
								url:'view/bill-edit.html',
								id:'billEdit',
								createNew:false
							})
							Drag = 0;
						}else{
							//console.log('list')
							this.innerHTML = '编辑'
							mui.openWindow({
								url:'view/bill-list.html',
								id:'billList',
								createNew:false
							})
							Drag = 1;
						}
					})
				}
			}else if (Obj.code == 777){
				mui.toast('有人正在其他地方使用你的账户',{ duration:1000, type:'div' })
			}
		}
	})
}
//没做处理记得要再 user 下调用
function getBillList(opt){
	//参数必穿
	var config = {
		userId:'',//UserInfo.userId
		token:'',//UserInfo.userId
		callback:function(res){
			
		}
	}
	for(var i in opt ){
		config[i] = opt[i]
	}
	var Url = '?userId='+config.userId+'&token='+config.token;
	jsajax({
		method:'post',
		url:'http://139.129.203.90/caibao/car/list'+Url,
		success:function(res){
			config.callback(res)
		}
	})
}


</script>
</html>